<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/app-storage/app-localstorage/app-localstorage-document.html">
<link rel="import" href="/app/elements/htwg-iconset.html">
<link rel="import" href="/app/elements/htwg-navbar.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">

<dom-module name="container-select" attributes="url title">
    <style>
        paper-dropdown-menu {
            border: 3px solid var(--weather-primary-color);
            padding: 0 5px;
            width: calc(100% - 20px);

            --paper-input-container-label: {
                font-size: 13pt;
                font-weight: bold;
                color: var(--weather-primary-color);
            };
            --paper-input-container-input: {
                font-size: 13pt;
                font-weight: bold;
                color: var(--weather-primary-color);
            };
            --paper-input-container-underline: {
                display: none;
            };

            --paper-dropdown-menu-icon: {
                color: var(--weather-primary-color);
            };
        }

        paper-dropdown-menu {
          /*  border: 3px solid var(--weather-primary-color); */
            --paper-menu-button-dropdown: {
                margin-left: -8px !important;
                width: calc(100% - 36px);
                border: 3px solid var(--weather-primary-color);
            };
        }
        paper-listbox{
            --paper-listbox: {
                color: var(--weather-primary-color);
                border: 3px var(--weather-primary-color);
                width: 100%;
            }
        }

        .menu{
            margin-left: -8px;
            margin-top: -3px;
            right: 20px;
            left: 24px !important;
            }
   
    </style>

    <template>
        <paper-dropdown-menu id="menu" label="[[title]]" no-label-float vertical-align="top" horizontal-align="left" horizontal-offset="-8">
            <paper-listbox id="select" class="dropdown-content" on-iron-select="valueSelected">
                <template is="dom-repeat" items="[[items]]" as="item">
                    <paper-item value="[[item.value]]">[[item.name]]</paper-item>
                </template>
            </paper-listbox>
        </paper-dropdown-menu>
        <iron-ajax auto url="[[url]]" handle-as="json" on-response="setContent"></iron-ajax>
    </template>

    <script type="text/javascript">
        Polymer({
            is: "container-select",
            properties: {
                url: String,
                title: String,
                items: Array,
                value: String,
                defItem: Array
            },

            setContent: function (e, d) {
                this.data = d.response;
                this.setItems(this.data);
            },
            setItems: function (items) {
                console.log(items);

                if(!this.defItem) {
                    this.items = this.toArray(items);
                }
            },
            setDefault: function (defItem) {
                console.log(defItem);
                this.defItem = defItem;
                this.items = [this.defItem];

                // wait 100ms
                var select = this.$.select;
                setTimeout(function () {
                    select.selected = 0;
                }, 100);
            },
            valueSelected: function () {
                this.value = this.$.select.selectedItem.value;
                console.log(this.value);
                this.fire('value-selected');
            },
            toArray: function (obj) {
                return Object.keys(obj).map(function (key) {
                    return {
                        value: key,
                        name: obj[key]
                    }
                });
            }
        });

    </script>
</dom-module>